# Threat Model

Last Updated: May 24th, 2020.

Important definition at [Definitions.md].

R3 is designed to protect users and users' content against a range of threats, but there is no such thing as perfect security. In this document we will describe the treat model that R3 aims to follow in its design.

Our main goal, in broad terms, is to allow users to share content securely and privately. A user should generally expect to create or view a Share without being identified and without having to share the private data in the share with the site owner.

Unfortunately is impossible to guarantee perfect security - and we don't claim to do so. The code might contain bugs and design issues that make it vulnerable to attacks; if you're aware of any please [contact us](https://stefanovazzoler.com/#contact).

## Security Overview

When a user creates a Share the site generates 4 pairs of 3 random characters picked from a list of 60 alphanumeric entries (i.e.: `Il2.exa.mpl.ejR`); this is the default Share ID; such Share ID can be modified or regenerated by the user - although the default one gives more than 2e+21 possible entries the user could potentially make it simpler.

We first generate a Share Hash by taking the Share ID and using 1000 rounds of PBKDF2 with SHA-512 and the Hash Salt as salt using `crypto.subtle.deriveBits` to generate a partial hash; we then take what is approximately half of the significant characters of the base64 encoded version of such partial hash and hash that again this time using 500000 rounds of PBKDF2 with SHA-512 and the Hash Salt as salt using `crypto.subtle.deriveBits` - this is the Share Hash.

To encrypt the Share Content we first need to generate a Share Key. Such Share Key is generated by taking the Share ID, applying 800000 rounds of PBKDF2 with SHA-256 and adding a randomly generated Key Salt. We then take the Share Content and encrypt it using `AES-GCM-256`, the Share Key, and a randomly generated Encryption IV - this will produce the Encrypted Share Content.

The generated Share Hash, Encrypted Share Content, Encryption IV, Key Salt, Expiration Time, and Expiration Views are then sent to the server over a `TLS 1.2` or above connection before being stored in a Redis database.

When a user views a link (i.e.: goes to `https://rkt.one/#Il2.exa.mpl.ejR`), the same process above is done in reverse.

We first generate a Share Hash by taking the Share ID and applying the same process described above. We use the Share Hash to retrieve the Encrypted Share Content, Encryption IV, and Key Salt from the server if the Share has not expired.

We then generate the Share Key similarly to above but instead of using a randomly generated Key Salt we use the server-provided one and then proceed with the decryption of the Encrypted Share Content using the server-provided Encryption IV and the Share Key we just generated; after using `AES-GCM-256` for decryption we perform some basic checks on the Share Content to make sure it confirms to what we expect and prompt the user to request if they trust the Share and the person who sent them the link. After the user accepts the share we will try to securely load the content in the browser.

All the hashing, encryption, and checking mentioned above is performed in-browser client-side. The Share ID, Share Key, or partial hash is never sent to the server.

No external libraries are used for the encryption - and at the time of writing this document no 3rd party code and/or libraries are used in the client at all.

## What R3 does NOT protect you from

Some things are out of scope of the protection that we attempt to offer due to the nature of how this program works or due to other causes outside of our control.

### Compromised Devices

If your device, the device of those who you share the Share ID to, or if the way you share the Share ID is compromised the Share ID could potentially be transferred to 3rd parties therefore undermining the encryption we offer. We have no control over the devices people use to access our service or how they transfer the Share ID.

### Weak Share ID

We try to generate a reasonably secure random Share ID but if the user modifies it we cannot guarantee that it is not compromised.

### Unauthorized backdoor

If this service of its servers get compromised we cannot guarantee the security of the encryption (or encryption at all). We do our best to protect our service against such compromise, but if we or any of our service providers gets hacked we cannot guarantee anything.

## What R3 does protect you from

After a security and encryption review of R3 is completed it should be safe for most users to use the service to share non-sensitive content. If you are a target of sophisticated (or targeted) attacks we advise you not to use our service.

In general we try to protect against the following threats.

### Future DB leaks

If our Database ever gets compromised and/or leaked at a future time you should have a reasonable expectation that your Share is secure against all but the most sophisticated targeted attacks.

### Unsophisticated Non-Targeted Attacks

We do our best to protect your data through the use of multiple level of security measures against unsophisticated and non-targeted attacks. We employ industry standard methods to secure and lock down our servers against both external threats and potential escalation of privileges if they get partially compromised.

### Service provider liability

Although this one is a little tricky as it depends on local laws, the server owner will not have insights over what is shared with the service and therefore makes it harder to make them liable for the content share. This is especially useful for private individuals like the creator of R3 that do not have the time to monitor users' shares and also is most certainly against any kind of monitoring (read: spying) of what users' share.

### Privacy

The users should have a reasonable expectation of privacy. If the service cannot get compromised and maliciously changed (including by the service provider) the users data and identities should remain private and not be collected.
